<%-- 
OrderConfirmation.jsp
Module 7 assignment
Name: Brittany Kyncl
Date: 6.30.23
Course: CSD430
NOTICE OF REVISION:
To adhere more to MCV the controller logic responsible for manipulating the shopping cart has been extracted
into a separate CartController class. This promotes a clearer separation of concerns, with the JSP file focusing
on presentation and user interaction, while the controller class handles the business logic.
code exampled from source: "Beginning Jarkarta EE Web Development: 3rd Edition" by Manelli, Zambon
--%>

<%@page language="java" contentType="text/html"%>
<%@page import="java.util.Hashtable"%>
<%@page import="eshop.beans.CartItem"%>
<jsp:useBean id="cartController" class="eshop.controller.CartController"/>

<jsp:useBean id="dataManager" scope="application"
  class="eshop.model.DataManager"/>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <title>Order</title>
  <link rel="stylesheet" href="/eshop/css/eshop.css" type="text/css"/>
  </head>
<body>
<jsp:include page="TopMenu.jsp" flush="true"/>
<jsp:include page="LeftMenu.jsp" flush="true"/>
<div class="content">
  <h2>Order</h2>
  <jsp:useBean id="customer" class="eshop.beans.Customer"/>
  <jsp:setProperty property="*" name="customer"/>
<%
    // Retrieve the shopping cart using the CartController
    Hashtable<String, CartItem> cart = cartController.getShoppingCart(request);

    // Insert the order and get the order ID
    long orderId = dataManager.insertOrder(customer, cart);
    if (orderId > 0L) {
      // If the order is successful, invalidate the session to clear the cart
      session.invalidate();
%>
      <p class="info">
        Thank you for your purchase.<br/>
        Your Order Number is: <%=orderId%>
        </p>
<%
      }
    else {
      %><p class="error">Unexpected error processing the order!</p><%
      }
  %>
  </div>
</body>
</html>
